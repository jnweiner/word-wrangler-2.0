<!DOCTYPE html>
<html>
  <head>
    <script src="jquery-3.5.1.js"></script>
    <script src="words.js"></script>
    <title>Word Wrangler</title>
    <link rel="stylesheet" href="main.css">
    <link href="https://fonts.googleapis.com/css2?family=Rye&display=swap" rel="stylesheet">
  </head>
  <body>
    <header>
      <h1>WORD WRANGLER</h1>
      <h2>Time to wrangle some words!</h2>
    </header>
    <div class="level">
    </div>
    <div class="show-points">
    </div>
    <div class="hiddenwords">
    </div>
    <div class="action">
      <span>Guess a word: </span><input type="text" class="guess"/>
      <button class="submit">Submit guess!</button>
      <button class="scramble">Scramble master word again</button>
      <button class="reveal">Reveal hidden word</button>
    </div>

    <script>
      $(document).ready(function() {

        // FUNCTIONS

        function scramble(word) {
          const chars = word.split('');
          for (let i = chars.length - 1; i > 0; i--) {
            let j = Math.floor(Math.random() * i);
            let temp = chars[i];
            chars[i] = chars[j];
            chars[j] = temp;
          }
          return chars.join('');
        };

        function calculateTotalPoints(answers) {
          let totalPoints = 0;
          answers.forEach(function(answer) {
            totalPoints += answer.length;
          });
          return totalPoints;
        };

        function displayWords(wordLength, answers) {
          let guessesToDisplay = [];
          correctGuesses.forEach(function(guess) {
            if (guess.length === wordLength) {
              guessesToDisplay.push(guess);
            }
          });

          let answerAmount = 0;
          answers.forEach(function(answer) {
            if (answer.length === wordLength) {
              answerAmount += 1;
            }
          });

          let n = 0;
          while (n < answerAmount) {
            let $word = $("<div class='word'></div>");
            if (n < guessesToDisplay.length) {
              $word.text(`${n + 1}) ${guessesToDisplay[n]}`);
              if (guessesToDisplay[n] === correctGuesses[correctGuesses.length - 1]) {
                $word.css("color", "rgba(67, 135, 54, 1)");
              }
            } else {
              $word.text(`${n + 1})`);
            }
            $word.appendTo($hiddenWords);
            n += 1;
          }
        };

        function displayProgress(masterWord, answers) {
          $pointsDisplay.text(`Your points: ${points.player} out of ${points.total} possible points`)
          $pointsDisplay.appendTo(".show-points");
          let wordLength = 3;
          while (wordLength <= masterWord.length) {
            let $hiddenflag = $("<div class='hiddenflag'></div>");
            $hiddenflag.text(`HIDDEN ${wordLength}-LETTER WORDS`);
            $hiddenflag.appendTo($hiddenWords);
            displayWords(wordLength, answers);
            if (wordLength !== masterWord.length) {
              $("<br>").appendTo($hiddenWords);
            }
            wordLength +=1;
          }
        };

        function generateRandomWord() {
          while (true) {
            let index = Math.floor(Math.random() * (answers.length));
            if (!correctGuesses.includes(answers[index])) {
              correctGuesses.push(answers[index]);
              return answers[index];
              break;
            }
          }
        };

        // SET-UP

        let points = {
          player: 0,
          total: 0
        };

        let currentLevel = 0;
        points.total = calculateTotalPoints(wordsAndAnswers[currentLevel].answers)
        let correctGuesses = [];
        let masterWord = wordsAndAnswers[currentLevel].word;
        let answers = wordsAndAnswers[currentLevel].answers;

        let $hiddenWords = $(".hiddenwords");

        let $masterword = $('<div class="masterword"></div>');
        $masterword.text(`${scramble(masterWord)}`);

        let $pointsDisplay = $('<div class="points"></div>');
        $pointsDisplay.text(`Your points: ${points.player} out of ${points.total} possible points`);

        $masterword.appendTo(".level");

        displayProgress(masterWord, answers);

        let $message = $("<div class='message'></div>");


        // EVENT LISTENERS

        $(".submit").on("click", function() {
          $message.text('');
          let playerGuess = $(".guess").val();
          playerGuess = playerGuess.toLowerCase();
          if (correctGuesses.includes(playerGuess)) {
            $message.text("Already got that one, try again!");
          } else if (answers.includes(playerGuess)) {
            correctGuesses.push(playerGuess);
            $hiddenWords.html('');
            points.player += playerGuess.length;
            displayProgress(masterWord, answers);
            $message.text("Correct!");
          } else {
            $message.text("Try again!");
          }
          $message.appendTo(".action");
          $(".guess").val('');
        });

        $(".scramble").on("click", function() {
          $masterword.text(`${scramble(masterWord)}`);
        });

        $(".reveal").on("click", function() {
          let randomWord = generateRandomWord();
          points.player -= randomWord.length;
          $hiddenWords.html('');
          displayProgress(masterWord, answers);
        });




      });
    </script>
  </body>
</html>